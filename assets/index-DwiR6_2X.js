(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();const X=e=>{e.classList.toggle("card__like-button_is-active")},Y=e=>{e.remove()},Z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,t,{onPreviewPicture:n,onLikeIcon:o,onDeleteCard:r,onInfoClick:c})=>{const s=Z(),f=s.querySelector(".card__like-button"),h=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),i=s.querySelector(".card__like-count"),u=s.querySelector(".card__title"),G=s.querySelector(".card__control-button_type_info");S.src=e.link,S.alt=e.name,u.textContent=e.name,i.textContent=e.likes.length;const B=e.likes.some(Q=>Q._id===t);return B&&f.classList.add("card__like-button_is-active"),e.owner._id!==t&&(h.style.display="none"),f.addEventListener("click",()=>{o&&o(e._id,f,i,B)}),h.addEventListener("click",()=>{r&&r(e._id,s)}),n&&S.addEventListener("click",()=>n({name:e.name,link:e.link})),G.addEventListener("click",()=>{c&&c(e._id)}),s},A=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",A)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",A)},ee=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&d(e)})},te="97dc7063-4d68-4f70-bf54-83ff90e3446d",oe="apf-cohort-202",l={baseUrl:`https://mesto.nomoreparties.co/v1/${oe}`,headers:{authorization:`${te}`,"Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(e.status),ne=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(m),C=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(m),re=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(m),ce=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(m),se=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(m),ie=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(m),le=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(n=>m(n)),T=(e,t,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add("popup__input_type_error"),o&&(o.textContent=n,o.classList.add("popup__error_visible"))},D=(e,t)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove("popup__input_type_error"),n&&(n.classList.remove("popup__error_visible"),n.textContent="")},ae=(e,t)=>{t.validity.valid?D(e,t):t.dataset.errorMessage&&t.validity.patternMismatch?T(e,t,t.dataset.errorMessage):T(e,t,t.validationMessage)},pe=e=>e.some(t=>!t.validity.valid),F=e=>{e.classList.add("popup__button_disabled"),e.disabled=!0},ue=e=>{e.classList.remove("popup__button_disabled"),e.disabled=!1},U=(e,t)=>{pe(e)?F(t):ue(t)},de=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");U(t,n),t.forEach(o=>{o.addEventListener("input",()=>{ae(e,o),U(t,n)})})},b=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach(o=>{D(e,o)}),F(n),e.reset()},_e=()=>{Array.from(document.querySelectorAll(".popup__form")).forEach(t=>{de(t)})},N=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),v=k.querySelector(".popup__form"),W=v.querySelector(".popup__input_type_name"),j=v.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),y=x.querySelector(".popup__form"),me=y.querySelector(".popup__input_type_card-name"),fe=y.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),O=E.querySelector(".popup__image"),ye=E.querySelector(".popup__caption"),he=document.querySelector(".profile__edit-button"),Se=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),g=M.querySelector(".popup__form"),ge=g.querySelector(".popup__input"),a=document.querySelector(".popup_type_info"),ve=a.querySelector(".popup__info"),H=a.querySelector(".popup__title"),L=document.querySelector(".popup_type_remove-card"),Le=L.querySelector(".popup__button"),qe=document.querySelector(".header__logo");console.log(ve);let q=null;const R=({name:e,link:t})=>{O.src=t,O.alt=e,ye.textContent=e,_(E)},Ce=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Сохранение...",re({name:W.value,about:j.value}).then(o=>{I.textContent=o.name,w.textContent=o.about,d(k)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},be=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Сохранение...",ce({avatar:ge.value}).then(o=>{P.style.backgroundImage=`url(${o.avatar})`,d(M)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},ke=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Создание...",se({name:me.value,link:fe.value}).then(o=>{N.prepend($(o,q,{onPreviewPicture:R,onLikeIcon:J,onDeleteCard:V,onInfoClick:K})),d(x)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},J=(e,t,n,o)=>{le(e,o).then(r=>{X(t),n.textContent=r.likes.length}).catch(r=>{console.log(r)})},V=(e,t)=>{_(L),Le.addEventListener("click",()=>{ie(e).then(()=>{Y(t)}).catch(n=>{console.log(n)}).finally(()=>{d(L)})})},xe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),p=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},z=e=>{const n=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return n.textContent=e.name,n},K=e=>{const t=a.querySelector(".popup__info"),n=a.querySelector(".popup__list"),o=a.querySelector(".popup__text");t.innerHTML="",n.innerHTML="",H.textContent="Информация о карточке",C().then(r=>{const c=r.find(s=>s._id===e);t.append(p("Описание:",c.name)),t.append(p("Дата создания:",xe(new Date(c.createdAt)))),t.append(p("Владелец:",c.owner.name||c.owner._id)),t.append(p("Количество лайков:",c.likes.length.toString())),o.textContent="Лайкнули:",c.likes.forEach(s=>{n.append(z(s))}),_(a)}).catch(r=>{console.log(r)})},Ee=()=>{const e=a.querySelector(".popup__info"),t=a.querySelector(".popup__list"),n=a.querySelector(".popup__text");C().then(o=>{e.textContent="",t.textContent="",H.textContent="Статистика карточек";const r=o.reduce((i,u)=>i+u.likes.length,0);e.append(p("Всего лайков:",r));const s=new Set(o.map(i=>i.owner._id)).size;e.append(p("Всего пользователей:",s));const f=o.reduce((i,u)=>Math.max(i,u.likes.length),0);e.append(p("Максимально лайков от одного:",f));const h=o.find(i=>i.likes.length===f);e.append(p("Чемпион лайков:",h.owner.name)),n.textContent="Популярные карточки",o.sort((i,u)=>u.likes.length-i.likes.length).slice(0,3).forEach(i=>{t.append(z(i))}),_(a)}).catch(o=>{console.log(o)})};v.addEventListener("submit",Ce);y.addEventListener("submit",ke);g.addEventListener("submit",be);he.addEventListener("click",()=>{b(v),W.value=I.textContent,j.value=w.textContent,_(k)});P.addEventListener("click",()=>{g.reset(),b(g),_(M)});Se.addEventListener("click",()=>{y.reset(),b(y),_(x)});qe.addEventListener("click",()=>{Ee()});const Ie=document.querySelectorAll(".popup");Ie.forEach(e=>{ee(e)});document.addEventListener("DOMContentLoaded",()=>{_e()});Promise.all([C(),ne()]).then(([e,t])=>{q=t._id,I.textContent=t.name,w.textContent=t.about,P.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{N.append($(n,q,{onPreviewPicture:R,onLikeIcon:J,onDeleteCard:V,onInfoClick:K}))})}).catch(e=>{console.log(e)});
