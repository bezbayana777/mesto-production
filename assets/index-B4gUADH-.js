(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();const X=e=>{e.classList.toggle("card__like-button_is-active")},Y=e=>{e.remove()},Z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,t,{onPreviewPicture:n,onLikeIcon:o,onDeleteCard:r,onInfoClick:c})=>{const s=Z(),f=s.querySelector(".card__like-button"),h=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),i=s.querySelector(".card__like-count"),u=s.querySelector(".card__title"),G=s.querySelector(".card__control-button_type_info");S.src=e.link,S.alt=e.name,u.textContent=e.name,i.textContent=e.likes.length;const B=e.likes.some(Q=>Q._id===t);return B&&f.classList.add("card__like-button_is-active"),e.owner._id!==t&&(h.style.display="none"),f.addEventListener("click",()=>{o&&o(e._id,f,i,B)}),h.addEventListener("click",()=>{r&&r(e._id,s)}),n&&S.addEventListener("click",()=>n({name:e.name,link:e.link})),G.addEventListener("click",()=>{c&&c(e._id)}),s},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},ee=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&d(e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"97dc7063-4d68-4f70-bf54-83ff90e3446d","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(e.status),te=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(m),C=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(m),oe=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(m),ne=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(m),re=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(m),ce=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(m),se=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(n=>m(n)),T=(e,t,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add("popup__input_type_error"),o&&(o.textContent=n,o.classList.add("popup__error_visible"))},F=(e,t)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove("popup__input_type_error"),n&&(n.classList.remove("popup__error_visible"),n.textContent="")},ie=(e,t)=>{t.validity.valid?F(e,t):t.dataset.errorMessage&&t.validity.patternMismatch?T(e,t,t.dataset.errorMessage):T(e,t,t.validationMessage)},le=e=>e.some(t=>!t.validity.valid),D=e=>{e.classList.add("popup__button_disabled"),e.disabled=!0},ae=e=>{e.classList.remove("popup__button_disabled"),e.disabled=!1},U=(e,t)=>{le(e)?D(t):ae(t)},pe=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");U(t,n),t.forEach(o=>{o.addEventListener("input",()=>{ie(e,o),U(t,n)})})},b=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach(o=>{F(e,o)}),D(n),e.reset()},ue=()=>{Array.from(document.querySelectorAll(".popup__form")).forEach(t=>{pe(t)})},N=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),v=k.querySelector(".popup__form"),W=v.querySelector(".popup__input_type_name"),j=v.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),y=x.querySelector(".popup__form"),de=y.querySelector(".popup__input_type_card-name"),_e=y.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),A=E.querySelector(".popup__image"),me=E.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),w=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),g=P.querySelector(".popup__form"),he=g.querySelector(".popup__input"),a=document.querySelector(".popup_type_info"),Se=a.querySelector(".popup__info"),H=a.querySelector(".popup__title"),L=document.querySelector(".popup_type_remove-card"),ge=L.querySelector(".popup__button"),ve=document.querySelector(".header__logo");console.log(Se);let q=null;const J=({name:e,link:t})=>{A.src=t,A.alt=e,me.textContent=e,_(E)},Le=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Сохранение...",oe({name:W.value,about:j.value}).then(o=>{I.textContent=o.name,w.textContent=o.about,d(k)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},qe=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Сохранение...",ne({avatar:he.value}).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,d(P)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},Ce=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Создание...",re({name:de.value,link:_e.value}).then(o=>{N.prepend(O(o,q,{onPreviewPicture:J,onLikeIcon:R,onDeleteCard:V,onInfoClick:K})),d(x)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},R=(e,t,n,o)=>{se(e,o).then(r=>{X(t),n.textContent=r.likes.length}).catch(r=>{console.log(r)})},V=(e,t)=>{_(L),ge.addEventListener("click",()=>{ce(e).then(()=>{Y(t)}).catch(n=>{console.log(n)}).finally(()=>{d(L)})})},be=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),p=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},z=e=>{const n=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return n.textContent=e.name,n},K=e=>{const t=a.querySelector(".popup__info"),n=a.querySelector(".popup__list"),o=a.querySelector(".popup__text");t.innerHTML="",n.innerHTML="",H.textContent="Информация о карточке",C().then(r=>{const c=r.find(s=>s._id===e);t.append(p("Описание:",c.name)),t.append(p("Дата создания:",be(new Date(c.createdAt)))),t.append(p("Владелец:",c.owner.name||c.owner._id)),t.append(p("Количество лайков:",c.likes.length.toString())),o.textContent="Лайкнули:",c.likes.forEach(s=>{n.append(z(s))}),_(a)}).catch(r=>{console.log(r)})},ke=()=>{const e=a.querySelector(".popup__info"),t=a.querySelector(".popup__list"),n=a.querySelector(".popup__text");C().then(o=>{e.textContent="",t.textContent="",H.textContent="Статистика карточек";const r=o.reduce((i,u)=>i+u.likes.length,0);e.append(p("Всего лайков:",r));const s=new Set(o.map(i=>i.owner._id)).size;e.append(p("Всего пользователей:",s));const f=o.reduce((i,u)=>Math.max(i,u.likes.length),0);e.append(p("Максимально лайков от одного:",f));const h=o.find(i=>i.likes.length===f);e.append(p("Чемпион лайков:",h.owner.name)),n.textContent="Популярные карточки",o.sort((i,u)=>u.likes.length-i.likes.length).slice(0,3).forEach(i=>{t.append(z(i))}),_(a)}).catch(o=>{console.log(o)})};v.addEventListener("submit",Le);y.addEventListener("submit",Ce);g.addEventListener("submit",qe);fe.addEventListener("click",()=>{b(v),W.value=I.textContent,j.value=w.textContent,_(k)});M.addEventListener("click",()=>{g.reset(),b(g),_(P)});ye.addEventListener("click",()=>{y.reset(),b(y),_(x)});ve.addEventListener("click",()=>{ke()});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{ee(e)});document.addEventListener("DOMContentLoaded",()=>{ue()});Promise.all([C(),te()]).then(([e,t])=>{q=t._id,I.textContent=t.name,w.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{N.append(O(n,q,{onPreviewPicture:J,onLikeIcon:R,onDeleteCard:V,onInfoClick:K}))})}).catch(e=>{console.log(e)});
