(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const G=e=>{e.classList.toggle("card__like-button_is-active")},Q=e=>{e.remove()},X=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),U=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r,onInfoClick:c})=>{const s=X(),y=s.querySelector(".card__like-button"),I=s.querySelector(".card__control-button_type_delete"),h=s.querySelector(".card__image"),P=s.querySelector(".card__like-count"),V=s.querySelector(".card__title"),K=s.querySelector(".card__control-button_type_info");h.src=e.link,h.alt=e.name,V.textContent=e.name,P.textContent=e.likes.length;const w=e.likes.some(z=>z._id===t);return w&&y.classList.add("card__like-button_is-active"),e.owner._id!==t&&(I.style.display="none"),y.addEventListener("click",()=>{n&&n(e._id,y,P,w)}),I.addEventListener("click",()=>{r&&r(e._id,s)}),o&&h.addEventListener("click",()=>o({name:e.name,link:e.link})),K.addEventListener("click",()=>{c&&c(e._id)}),s},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},u=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},Z="97dc7063-4d68-4f70-bf54-83ff90e3446d",ee="apf-cohort-202",i={baseUrl:`https://mesto.nomoreparties.co/v1/${ee}`,headers:{authorization:`${Z}`,"Content-Type":"application/json"}},l=e=>e.ok?e.json():Promise.reject(e.status),te=()=>fetch(`${i.baseUrl}/users/me`,{headers:i.headers}).then(l),A=()=>fetch(`${i.baseUrl}/cards`,{headers:i.headers}).then(l),oe=({name:e,about:t})=>fetch(`${i.baseUrl}/users/me`,{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(l),ne=({avatar:e})=>fetch(`${i.baseUrl}/users/me/avatar`,{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:e})}).then(l),re=({name:e,link:t})=>fetch(`${i.baseUrl}/cards`,{method:"POST",headers:i.headers,body:JSON.stringify({name:e,link:t})}).then(l),ce=e=>fetch(`${i.baseUrl}/cards/${e}`,{method:"DELETE",headers:i.headers}).then(l),se=(e,t)=>fetch(`${i.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:i.headers}).then(o=>l(o)),B=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add("popup__input_type_error"),n&&(n.textContent=o,n.classList.add("popup__error_visible"))},O=(e,t)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove("popup__input_type_error"),o&&(o.classList.remove("popup__error_visible"),o.textContent="")},ie=(e,t)=>{t.validity.valid?O(e,t):t.dataset.errorMessage&&t.validity.patternMismatch?B(e,t,t.dataset.errorMessage):B(e,t,t.validationMessage)},ae=e=>e.some(t=>!t.validity.valid),D=e=>{e.classList.add("popup__button_disabled"),e.disabled=!0},le=e=>{e.classList.remove("popup__button_disabled"),e.disabled=!1},M=(e,t)=>{ae(e)?D(t):le(t)},ue=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");M(t,o),t.forEach(n=>{n.addEventListener("input",()=>{ie(e,n),M(t,o)})})},g=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");t.forEach(n=>{O(e,n)}),D(o),e.reset()},pe=()=>{Array.from(document.querySelectorAll(".popup__form")).forEach(t=>{ue(t)})},F=document.querySelector(".places__list"),b=document.querySelector(".popup_type_edit"),f=b.querySelector(".popup__form"),N=f.querySelector(".popup__input_type_name"),W=f.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_new-card"),d=L.querySelector(".popup__form"),de=d.querySelector(".popup__input_type_card-name"),_e=d.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),T=q.querySelector(".popup__image"),me=q.querySelector(".popup__caption"),fe=document.querySelector(".profile__edit-button"),ye=document.querySelector(".profile__add-button"),C=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_edit-avatar"),m=x.querySelector(".popup__form"),he=m.querySelector(".popup__input"),p=document.querySelector(".popup_type_info"),ve=p.querySelector(".popup__info"),v=document.querySelector(".popup_type_remove-card"),Se=v.querySelector(".popup__button");console.log(ve);let S=null;const H=({name:e,link:t})=>{T.src=t,T.alt=e,me.textContent=e,u(q)},ge=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Сохранение...",oe({name:N.value,about:W.value}).then(n=>{C.textContent=n.name,k.textContent=n.about,a(b)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},be=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Сохранение...",ne({avatar:he.value}).then(n=>{E.style.backgroundImage=`url(${n.avatar})`,a(x)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},Le=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Создание...",re({name:de.value,link:_e.value}).then(n=>{F.prepend(U(n,S,{onPreviewPicture:H,onLikeIcon:R,onDeleteCard:j,onInfoClick:J})),a(L)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},R=(e,t,o,n)=>{se(e,n).then(r=>{G(t),o.textContent=r.likes.length}).catch(r=>{console.log(r)})},j=(e,t)=>{u(v),Se.addEventListener("click",()=>{ce(e).then(()=>{Q(t)}).catch(o=>{console.log(o)}).finally(()=>{a(v)})})},qe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),_=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},Ce=e=>{const o=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return o.textContent=e.name,o},J=e=>{const t=p.querySelector(".popup__info"),o=p.querySelector(".popup__list"),n=p.querySelector(".popup__text");t.innerHTML="",o.innerHTML="",A().then(r=>{const c=r.find(s=>s._id===e);t.append(_("Описание:",c.name)),t.append(_("Дата создания:",qe(new Date(c.createdAt)))),t.append(_("Владелец:",c.owner.name||c.owner._id)),t.append(_("Количество лайков:",c.likes.length.toString())),n.textContent="Лайкнули:",c.likes.forEach(s=>{o.append(Ce(s))}),u(p)}).catch(r=>{console.log(r)})};f.addEventListener("submit",ge);d.addEventListener("submit",Le);m.addEventListener("submit",be);fe.addEventListener("click",()=>{g(f),N.value=C.textContent,W.value=k.textContent,u(b)});E.addEventListener("click",()=>{m.reset(),g(m),u(x)});ye.addEventListener("click",()=>{d.reset(),g(d),u(L)});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Y(e)});document.addEventListener("DOMContentLoaded",()=>{pe()});Promise.all([A(),te()]).then(([e,t])=>{S=t._id,C.textContent=t.name,k.textContent=t.about,E.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{F.append(U(o,S,{onPreviewPicture:H,onLikeIcon:R,onDeleteCard:j,onInfoClick:J}))})}).catch(e=>{console.log(e)});
