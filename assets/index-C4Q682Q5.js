(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();const Q=e=>{e.classList.toggle("card__like-button_is-active")},X=e=>{e.remove()},Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,t,{onPreviewPicture:n,onLikeIcon:o,onDeleteCard:r,onInfoClick:c})=>{const s=Y(),u=s.querySelector(".card__like-button"),h=s.querySelector(".card__control-button_type_delete"),S=s.querySelector(".card__image"),i=s.querySelector(".card__like-count"),d=s.querySelector(".card__title"),G=s.querySelector(".card__control-button_type_info");return S.src=e.link,S.alt=e.name,d.textContent=e.name,i.textContent=e.likes.length,e.likes.some(L=>L._id===t)&&u.classList.add("card__like-button_is-active"),e.owner._id!==t&&(h.style.display="none"),u.addEventListener("click",()=>{if(o){const L=u.classList.contains("card__like-button_is-active");o(e._id,u,i,L)}}),h.addEventListener("click",()=>{r&&r(e._id,s)}),n&&S.addEventListener("click",()=>n({name:e.name,link:e.link})),G.addEventListener("click",()=>{c&&c(e._id)}),s},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");_(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},_=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{_(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&_(e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"97dc7063-4d68-4f70-bf54-83ff90e3446d","Content-Type":"application/json"}},f=e=>e.ok?e.json():Promise.reject(e.status),ee=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(f),b=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(f),te=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(f),oe=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(f),ne=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(f),re=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(f),ce=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(n=>f(n)),U=(e,t,n)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add("popup__input_type_error"),o&&(o.textContent=n,o.classList.add("popup__error_visible"))},F=(e,t)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove("popup__input_type_error"),n&&(n.classList.remove("popup__error_visible"),n.textContent="")},se=(e,t)=>{t.validity.valid?F(e,t):t.dataset.errorMessage&&t.validity.patternMismatch?U(e,t,t.dataset.errorMessage):U(e,t,t.validationMessage)},ie=e=>e.some(t=>!t.validity.valid),D=e=>{e.classList.add("popup__button_disabled"),e.disabled=!0},le=e=>{e.classList.remove("popup__button_disabled"),e.disabled=!1},T=(e,t)=>{ie(e)?D(t):le(t)},ae=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");T(t,n),t.forEach(o=>{o.addEventListener("input",()=>{se(e,o),T(t,n)})})},k=e=>{const t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach(o=>{F(e,o)}),D(n),e.reset()},pe=()=>{Array.from(document.querySelectorAll(".popup__form")).forEach(t=>{ae(t)})},N=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),v=x.querySelector(".popup__form"),W=v.querySelector(".popup__input_type_name"),j=v.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),y=E.querySelector(".popup__form"),ue=y.querySelector(".popup__input_type_card-name"),de=y.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),A=I.querySelector(".popup__image"),_e=I.querySelector(".popup__caption"),me=document.querySelector(".profile__edit-button"),fe=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),g=P.querySelector(".popup__form"),ye=g.querySelector(".popup__input"),a=document.querySelector(".popup_type_info"),he=a.querySelector(".popup__info"),H=a.querySelector(".popup__title"),C=document.querySelector(".popup_type_remove-card"),Se=C.querySelector(".popup__button"),ge=document.querySelector(".header__logo");console.log(he);let q=null;const J=({name:e,link:t})=>{A.src=t,A.alt=e,_e.textContent=e,m(I)},ve=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Сохранение...",te({name:W.value,about:j.value}).then(o=>{w.textContent=o.name,B.textContent=o.about,_(x)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},Le=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Сохранение...",oe({avatar:ye.value}).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,_(P)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},Ce=e=>{e.preventDefault();const t=e.submitter,n=t.textContent;t.textContent="Создание...",ne({name:ue.value,link:de.value}).then(o=>{N.prepend(O(o,q,{onPreviewPicture:J,onLikeIcon:R,onDeleteCard:V,onInfoClick:K})),_(E)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n})},R=(e,t,n,o)=>{ce(e,o).then(r=>{Q(t),n.textContent=r.likes.length}).catch(r=>{console.log(r)})},V=(e,t)=>{m(C),Se.addEventListener("click",()=>{re(e).then(()=>{X(t)}).catch(n=>{console.log(n)}).finally(()=>{_(C)})})},qe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),p=(e,t)=>{const o=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},z=e=>{const n=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return n.textContent=e.name,n},K=e=>{const t=a.querySelector(".popup__info"),n=a.querySelector(".popup__list"),o=a.querySelector(".popup__text");t.innerHTML="",n.innerHTML="",H.textContent="Информация о карточке",b().then(r=>{const c=r.find(s=>s._id===e);t.append(p("Описание:",c.name)),t.append(p("Дата создания:",qe(new Date(c.createdAt)))),t.append(p("Владелец:",c.owner.name||c.owner._id)),t.append(p("Количество лайков:",c.likes.length.toString())),o.textContent="Лайкнули:",c.likes.forEach(s=>{n.append(z(s))}),m(a)}).catch(r=>{console.log(r)})},be=()=>{const e=a.querySelector(".popup__info"),t=a.querySelector(".popup__list"),n=a.querySelector(".popup__text");b().then(o=>{e.textContent="",t.textContent="",H.textContent="Статистика карточек";const r=o.reduce((i,d)=>i+d.likes.length,0);e.append(p("Всего лайков:",r));const s=new Set(o.map(i=>i.owner._id)).size;e.append(p("Всего пользователей:",s));const u=o.reduce((i,d)=>Math.max(i,d.likes.length),0);e.append(p("Максимально лайков от одного:",u));const h=o.find(i=>i.likes.length===u);e.append(p("Чемпион лайков:",h.owner.name)),n.textContent="Популярные карточки",o.sort((i,d)=>d.likes.length-i.likes.length).slice(0,3).forEach(i=>{t.append(z(i))}),m(a)}).catch(o=>{console.log(o)})};v.addEventListener("submit",ve);y.addEventListener("submit",Ce);g.addEventListener("submit",Le);me.addEventListener("click",()=>{k(v),W.value=w.textContent,j.value=B.textContent,m(x)});M.addEventListener("click",()=>{g.reset(),k(g),m(P)});fe.addEventListener("click",()=>{y.reset(),k(y),m(E)});ge.addEventListener("click",()=>{be()});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Z(e)});document.addEventListener("DOMContentLoaded",()=>{pe()});Promise.all([b(),ee()]).then(([e,t])=>{q=t._id,w.textContent=t.name,B.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{N.append(O(n,q,{onPreviewPicture:J,onLikeIcon:R,onDeleteCard:V,onInfoClick:K}))})}).catch(e=>{console.log(e)});
